# generated by datamodel-codegen:
#   filename:  agentUpdateStream.json
#   timestamp: 2026-02-01T09:43:59+00:00

from __future__ import annotations

from enum import Enum
from typing import Any, Dict, List, Optional

from pydantic import BaseModel, ConfigDict, Field
from typing_extensions import Annotated, Literal

from . import agentNode


class Tool(BaseModel):
    name: Annotated[str, Field(description='Name of the tool')]
    input: Optional[Dict[str, Any]] = None
    result: Optional[Dict[str, Any]] = None


class ChatContentType(Enum):
    Generic = 'Generic'
    FileAttachment = 'FileAttachment'


class FileAttachment(BaseModel):
    type: Optional[ChatContentType] = ChatContentType.FileAttachment
    fileName: Annotated[str, Field(description='Name of the attached file')]
    fileType: Annotated[str, Field(description='MIME type of the file')]
    fileSize: Annotated[int, Field(description='Size of the file in bytes')]
    fileId: Annotated[
        Optional[str],
        Field(None, description='Unique identifier for the file (e.g., Slack file ID)'),
    ]
    content: Annotated[
        Optional[str], Field(None, description='File content (for text files like CSV)')
    ]
    isCsv: Annotated[
        Optional[bool], Field(False, description='Whether this file is a CSV file')
    ]
    error: Annotated[
        Optional[str],
        Field(None, description='Error message if file processing failed'),
    ]
    metadata: Annotated[
        Optional[Dict[str, str]],
        Field(None, description='Additional metadata about the file'),
    ]


class ComponentType(Enum):
    search = 'search'
    lineage = 'lineage'
    rca = 'rca'
    details = 'details'
    chart = 'chart'
    code = 'code'
    powerbi = 'powerbi'
    table = 'table'
    git = 'git'
    profile = 'profile'
    glossary = 'glossary'
    glossaryTerm = 'glossaryTerm'


class TextMessageType(Enum):
    plain = 'plain'
    markdown = 'markdown'


class TextMessage(BaseModel):
    type: Optional[TextMessageType] = TextMessageType.plain
    message: Annotated[
        Optional[str], Field(None, description='Message content in Markdown format')
    ]


class StopReason(Enum):
    stop_sequence = 'stop_sequence'
    max_tokens = 'max_tokens'
    tool_use = 'tool_use'
    error = 'error'


class Sender(Enum):
    human = 'human'
    assistant = 'assistant'
    system = 'system'


class MessageAttachment(BaseModel):
    id: Optional[agentNode.Uuid] = None
    name: Optional[str] = None
    type: Optional[str] = None
    size: Optional[int] = None
    url: Optional[str] = None


class LlmCallTokens(BaseModel):
    inputTokens: Annotated[Optional[int], Field(None, ge=0)]
    outputTokens: Annotated[Optional[int], Field(None, ge=0)]
    step: Annotated[
        Optional[str],
        Field(
            None, description='The specific agent node or step that executed this call'
        ),
    ]
    tool: Annotated[
        Optional[str],
        Field(None, description='The name of the tool executed (if applicable)'),
    ]


class Tokens(BaseModel):
    inputTokens: Optional[int] = None
    outputTokens: Optional[int] = None
    totalTokens: Optional[int] = None
    detailedTokensPerCall: Annotated[
        Optional[List[LlmCallTokens]],
        Field(
            None,
            description='Detailed breakdown of tokens per individual LLM call during agent execution',
        ),
    ]


class ActionCount(BaseModel):
    name: Optional[str] = None
    count: Optional[int] = None


class ActionUsage(BaseModel):
    actions: Optional[List[ActionCount]] = None
    totalActions: Optional[int] = None
    timestamp: Optional[int] = None


class ComponentItem(BaseModel):
    type: Optional[ComponentType] = None
    content: Optional[Dict[str, Any]] = None


class MessageBlock(BaseModel):
    type: Optional[ChatContentType] = ChatContentType.Generic
    textMessage: Optional[TextMessage] = None
    component: Annotated[
        Optional[List[ComponentItem]],
        Field(
            None,
            description='Optional modules for the message, such as code searchMetadata, lineage, data quality, etc.',
        ),
    ]
    tools: Annotated[
        Optional[List[Tool]],
        Field(
            None,
            description='Optional modules for the message, such as code searchMetadata, lineage, data quality, etc.',
        ),
    ]
    attachments: Annotated[
        Optional[List[FileAttachment]],
        Field(None, description='File attachments associated with this message block'),
    ]


class ChatMessage(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    id: Annotated[
        agentNode.Uuid, Field(description='Unique identifier for the message')
    ]
    conversationId: Annotated[
        agentNode.Uuid,
        Field(description='ID of the chat session this message belongs to'),
    ]
    sender: Sender
    index: Annotated[
        int, Field(description='Sequential index of the message in the conversation')
    ]
    timestamp: Annotated[
        agentNode.Timestamp, Field(description='Timestamp when the message was sent.')
    ]
    content: Annotated[
        Optional[List[MessageBlock]],
        Field(None, description='Rich content array supporting multiple content types'),
    ]
    tokens: Annotated[
        Optional[Tokens],
        Field(
            None, description='LLM provider tokens expended for generating this message'
        ),
    ]
    actions: Annotated[
        Optional[ActionUsage],
        Field(None, description='Actions performed during message generation'),
    ]
    stopReason: Optional[StopReason] = None
    truncated: Annotated[
        Optional[bool],
        Field(False, description='Whether the message content was truncated'),
    ]
    attachments: Annotated[
        Optional[List[MessageAttachment]],
        Field(None, description='File attachments associated with the message'),
    ]


class AgentUpdateStream(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    message: Annotated[
        ChatMessage, Field(description='The message content of the agent job update.')
    ]
    type: Annotated[
        Literal['update'],
        Field('update', description='Type of update message for the agent job.'),
    ]
